<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<window xmlns="http://schemas.haulmont.com/cuba/window.xsd"
        caption="msg://editorCaption"
        class="com.mschneider.pdischeduler.web.task.TaskEdit"
        datasource="taskDs"
        messagesPack="com.mschneider.pdischeduler.web.task">
    <dsContext>
        <datasource id="taskDs"
                    class="com.mschneider.pdischeduler.entity.Task"
                    view="task-view"/>
        <collectionDatasource id="projectsDs"
                              class="com.mschneider.pdischeduler.entity.Project">
            <query>
                <![CDATA[select e from pdischeduler$Project e
where e.id = :param$currProject]]>
            </query>
        </collectionDatasource>
        <collectionDatasource id="prevtaskDs"
                              class="com.mschneider.pdischeduler.entity.Task">
            <query>
                <![CDATA[select e from pdischeduler$Task e
where e.project.id = :param$currProject order by e.name]]>
            </query>
        </collectionDatasource>
    </dsContext>
    <dialogMode height="600"
                width="800"/>
    <layout spacing="true">
        <scrollBox id="scrollBox"
                   height="100%"
                   spacing="true">
            <vbox margin="true"
                  spacing="true">
                <lookupField id="project"
                             caption="Project"
                             datasource="taskDs"
                             editable="false"
                             optionsDatasource="projectsDs"
                             property="project"
                             required="true"
                             width="300px"/>
                <textField id="name"
                           caption="Task name"
                           datasource="taskDs"
                           datatype="string"
                           property="name"
                           required="true"
                           width="100%"/>
                <textArea id="description"
                          caption="Task description"
                          datasource="taskDs"
                          property="description"
                          rows="3"
                          width="100%"/>
                <textField id="pdifile"
                           caption="PDI file"
                           contextHelpText="Path and name of .kjb file"
                           datasource="taskDs"
                           datatype="string"
                           property="pdiFile"
                           required="true"
                           width="100%"/>
                <textField id="pdiParameter"
                           caption="msg://pdiParameter"
                           contextHelpText="msg://pdiParameterDesc"
                           datasource="taskDs"
                           datatype="string"
                           property="pdiParameter"
                           width="100%"/>
                <lookupField id="logLevelLookup"
                             caption="Log Level"
                             datasource="taskDs"
                             property="logLevel"
                             required="true"
                             width="300px"/>
                <textField id="timeoutsec"
                           caption="Timeout sec"
                           datasource="taskDs"
                           datatype="int"
                           property="timeoutSec"
                           required="true"
                           width="300px"/>
                <textField id="sortkey"
                           caption="Sort key"
                           datasource="taskDs"
                           datatype="int"
                           property="sortKey"
                           required="true"
                           width="300px"/>
                <lookupField id="triggerTypeLookup"
                             caption="Trigger type"
                             datasource="taskDs"
                             nullOptionVisible="false"
                             property="triggerType"
                             width="300px"/>
                <vbox id="trigger_type_cron"
                      spacing="true">
                    <textField id="cronspec"
                               caption="Cron specification"
                               contextHelpText="msg://cronspecCaption"
                               datasource="taskDs"
                               datatype="string"
                               property="cronSpec"
                               width="100%">
                        <validator class="com.mschneider.pdischeduler.web.CronSpecValidator"/>
                    </textField>
                    <textField id="cronexcldates"
                               caption="Cron exclude dates"
                               contextHelpText="msg://cronexcldatesCaption"
                               datasource="taskDs"
                               datatype="string"
                               property="cronExclDates"
                               width="100%">
                        <validator class="com.mschneider.pdischeduler.web.CronExclValidator"/>
                    </textField>
                </vbox>
                <vbox id="trigger_type_prev"
                      spacing="true">
                    <lookupField id="prevtask"
                                 caption="Previous Task"
                                 datasource="taskDs"
                                 optionsDatasource="prevtaskDs"
                                 property="prevTask"
                                 width="300px"/>
                </vbox>
                <checkBox id="active"
                          caption="Active"
                          datasource="taskDs"
                          property="active"/>
                <frame id="windowActions"
                       screen="editWindowActions"/>
            </vbox>
        </scrollBox>
    </layout>
</window>
